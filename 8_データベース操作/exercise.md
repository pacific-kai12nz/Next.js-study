# 練習問題: データベース操作

## 問題1: 概念の理解

以下の質問に自分の言葉で回答してください：

1. CRUD操作とは何か、それぞれの操作が実際のアプリケーションでどのように使われるか説明してください。
CRUD操作とは、Create（作成）、Read（読み取り）、Update（更新）、Delete（削除）の頭文字を取ったもので、データベース操作の基本となる4つの操作を指します。

2. Prismaで`include`と`select`を使う違いとそれぞれの使用シーンについて説明してください。
必要最低限のデータを取得したい場合に使う
親データと関連データを一緒に使いたいときに便利

3. データベーストランザクションとは何か、なぜ重要なのか説明してください。
複数のDB操作をひとまとまりの処理として実行する仕組み。
データの整合性を守る（一部だけ成功して矛盾するのを防ぐ）
エラー時の安全な復元が可能

## 問題2: データの取得（Read）操作

ブログアプリケーションのデータ取得機能を実装しましょう。

1. 投稿一覧の取得
   - 前回作成したRoute Handlerを使用して、全ての投稿を取得するAPI実装を完成させる
   - 投稿を新しい順に並べ替え
   - 各投稿の著者情報も一緒に取得

2. 投稿詳細の取得
   - 特定の投稿IDに基づいて投稿詳細を取得するAPI実装を完成させる
   - 投稿の著者情報とコメント情報も一緒に取得
   - 存在しない投稿IDの場合は適切なエラーレスポンスを返す

## 問題3: データの作成と更新（Create & Update）操作

ブログアプリケーションの投稿作成・更新機能を実装しましょう。

1. 新規投稿の作成
   - 前回作成したRoute Handlerを使用して、新しい投稿を作成するAPI実装を完成させる
   - 必須フィールド（タイトル、内容など）のバリデーション
   - 作成した投稿を適切なレスポンスで返す

2. 投稿の更新
   - 特定の投稿IDに基づいて投稿を更新するAPI実装を完成させる
   - タイトル、内容、公開状態の更新をサポート
   - 存在しない投稿IDの場合は適切なエラーレスポンスを返す

## 問題4: データの削除（Delete）操作

ブログアプリケーションの投稿削除機能を実装しましょう。

1. 投稿の削除
   - 特定の投稿IDに基づいて投稿を削除するAPI実装を完成させる
   - 削除成功時と失敗時の適切なレスポンスを返す
   - オプション：関連するコメントも一緒に削除する実装を考える

## 問題5: ブログUIとの連携

作成したAPIエンドポイントをブログのUI部分と連携させましょう。

1. 投稿一覧ページでのデータ取得
   - Server Componentを使って投稿一覧を取得し表示
   - 各投稿の著者情報とともに表示
   - ページネーションまたは「もっと見る」ボタンの実装（オプション）

2. 投稿作成フォームの実装
   - クライアントコンポーネントでフォームを作成
   - フォーム送信時にPOST APIを呼び出す実装
   - 成功時と失敗時の適切なフィードバック表示

## ヒント

- Prismaでのデータ取得には、`findMany()`や`findUnique()`メソッドを使います
- データの並べ替えには、`orderBy`オプションを使用します
- リレーションデータの取得には、`include`オプションを使用します
- Server Componentでのデータ取得は非同期関数として実装します：
```typescript
export default async function Page() {
  const data = await prisma.model.findMany();
  // ...
}
```

- クライアントコンポーネントでのAPIリクエスト例：
```typescript
'use client';
// ...
const handleSubmit = async (e) => {
  e.preventDefault();
  const response = await fetch('/api/posts', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(formData)
  });
  
  if (response.ok) {
    // 成功時の処理
  } else {
    // エラー処理
  }
};
```
